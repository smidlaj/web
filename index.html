<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fot√≥p√°ly√°zati gal√©ria</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { display: flex; font-family: sans-serif; margin: 0; }
    aside { width: 200px; padding: 1rem; background: #f0f0f0; }
    main { flex-grow: 1; padding: 1rem; }
    .photo-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; }
    .photo img { width: 100%; border-radius: 5px; }
    .pagination { text-align: center; margin-top: 1rem; }
    .tag { background: #eef; border-radius: 5px; padding: 0.2em 0.5em; margin: 0.2em; display: inline-block; }
    .cert { max-width: 100%; margin-top: 5px; }
    .album-button { display: block; margin: 0.3rem 0; cursor: pointer; }
    .active-album { font-weight: bold; }
  </style>
</head>

<body>
    <button id="menu-toggle" aria-label="Men√º megnyit√°sa">‚ò∞</button>
    <aside>
      <h3>Albumok</h3>
      <div id="album-list"></div>
    </aside>
    <div id="content-wrapper">
    <main>
        <input type="text" id="search" placeholder="Keres√©s c√≠m, modell vagy p√°ly√°zat szerint..." style="width: 100%; padding: 0.5rem; margin-bottom: 1rem;">
        <div id="gallery" class="photo-grid"></div>
        <div class="pagination" id="pagination"></div>
    </main>
    </div>

<!-- <div id="age-modal" style="display:none;">
  <div id="age-modal-content">
    <p>Ez a honlap aktfot√≥kat is tartalmaz, ha fiatal vagy, akkor 
       a v√©g√©n m√©g meg√°llsz a fejl≈ëd√©sben, ha ilyesmit l√°tsz. Elm√∫lt√°l 18 √©ves?</p>
    <button id="btn-adult-yes">Igen, elm√∫ltam</button>
    <button id="btn-adult-no">Nem, m√©g nem</button>
  </div>
</div> -->


  <script>
    const PAGE_SIZE = 10;
    const albums = [
      { name: "√ñsszes", tags: [] },
      { name: "D√≠jazottak", tags: ["awarded"] },
      { name: "Monokr√≥m", tags: ["bw"] },
      { name: "Sz√≠nes", tags: ["color"] },
      { name: "Marilyn", tags: ["marilyn"] }
    ];

    const dialogs = [
        "Figyelem a gal√©ria egyes k√©pein f√∂rtelmes, erk√∂lcstelen tartalmak - meztelens√©g - is l√°that√≥. Elm√∫lt√°l m√°r 18?",
        "Itt egyes k√©peken meztelens√©g is megjelenik. Cserk√©szbecssz√≥, hogy elm√∫lt√°l m√°r 18?",
        "Ha ap√°caz√°rd√°ban dolgozol, vagy a munkahelyeden vagy, akkor a k√∂vetkez≈ë gal√©ria n√©zeget√©se k√≠nos perceket okozhat. Bev√°llalod?"
    ];

    const yesTexts = [
        "M√°r romlott a lelkem, mutass mindent!",
        "Persze ;)",
        "Persze, a f≈ën√∂k√∂m j√≥ arc!"
    ];

    const noTexts = [
        "Azt se tudom, mi az a meztelens√©g, √©n m√©g fiatal vagyok.",
        "Nem, nem, f√∫j, nem akarok ilyet l√°tni!",
        "Isten ments, a v√©g√©n m√©g el kell im√°dkoznom 3 Miaty√°nkot..."
    ];


    let photos = [];
    let filteredPhotos = [];
    let currentPage = 1;
    let currentAlbum = albums[0];
    let searchTerm = "";
    let salons = [];
    let models = [];
    window.isAdult = null;

function getRandomIndex() {
  return Math.floor(Math.random() * dialogs.length);
}

document.addEventListener('DOMContentLoaded', () => {
  window.isAdult = null;  // alap√©rtelmezett
  showAgeVerificationDialog();
});

function showAgeVerificationDialog() {
  const idx = getRandomIndex();

  const modal = document.createElement('div');
  modal.style.position = 'fixed';
  modal.style.top = '0'; modal.style.left = '0';
  modal.style.width = '100vw'; modal.style.height = '100vh';
  modal.style.backgroundColor = 'rgba(0,0,0,0.5)';
  modal.style.display = 'flex';
  modal.style.alignItems = 'center';
  modal.style.justifyContent = 'center';
  modal.style.zIndex = '10000';

  const box = document.createElement('div');
  box.style.background = '#fff';
  box.style.padding = '2rem';
  box.style.borderRadius = '8px';
  box.style.textAlign = 'center';
  box.style.maxWidth = '400px';
  box.innerHTML = `
    <p>${dialogs[idx]}</p>
    <button id="btnYes" style="margin-right:1rem;">${yesTexts[idx]}</button>
    <button id="btnNo">${noTexts[idx]}</button>
  `;

  modal.appendChild(box);
  document.body.appendChild(modal);

  document.getElementById('btnYes').onclick = () => {
    window.isAdult = true;
    document.body.removeChild(modal);
    applyFilters();
  };

  document.getElementById('btnNo').onclick = () => {
    window.isAdult = false;
    document.body.removeChild(modal);
    applyFilters();
  };
}

    async function loadData() {
        const [photosRes, salonsRes, modelsRes] = await Promise.all([
            fetch("data/photos.json"),
            fetch("data/salons.json"),
            fetch("data/models.json")
        ]);

        photos = await photosRes.json();
        salons = await salonsRes.json();
        models = await modelsRes.json();
        renderAlbums();
        applyFilters();
    }

    function renderAlbums() {
      const list = document.getElementById("album-list");
      list.innerHTML = "";
      albums.forEach((album, i) => {
        const btn = document.createElement("button");
        btn.textContent = album.name;
        btn.className = "album-button" + (i === 0 ? " active-album" : "");
        btn.onclick = () => {
          document.querySelectorAll(".album-button").forEach(b => b.classList.remove("active-album"));
          btn.classList.add("active-album");
          currentAlbum = album;
          currentPage = 1;
          applyFilters();
        };
        list.appendChild(btn);
      });
    }

function applyFilters() {
  filteredPhotos = photos.filter(photo => {
  
  if (window.isAdult === null) {
    return false;
  }
  if (window.isAdult === false && (photo.tags || []).includes('adult')) {
      return false;
    }
  if (!isPhotoVisible(photo)) {
        return false;
  }
const matchesSearch =
  searchTerm === "" ||
  photo.title.toLowerCase().includes(searchTerm) ||
  (photo.models || []).some(id => {
    const model = findModelById(id);
    return model && model.name.toLowerCase().includes(searchTerm);
  }) ||
  (photo.results || []).some(r => {
    const salon = findSalonById(r.id);
    return salon && salon.name.toLowerCase().includes(searchTerm);
  });

    const matchesAlbum =
      currentAlbum.tags.length === 0 ||
      currentAlbum.tags.some(tag => (photo.tags || []).includes(tag));

    return matchesSearch && matchesAlbum;
  });

  renderGallery();
}

    function isPhotoVisible(photo) {
        if (!Array.isArray(photo.models)) return true;

        for (const id of photo.models) {
            const model = findModelById(id);
            if (!model) continue;

            if (!model.visible) {
                return false;
            }

            if ((photo.tags || []).includes("adult") && model.adultVisible === false) {
                return false;
            }
        }

        return true;
    }


    function renderGallery() {
      const gallery = document.getElementById("gallery");
      const start = (currentPage - 1) * PAGE_SIZE;
      const end = start + PAGE_SIZE;
      const pagePhotos = filteredPhotos.slice(start, end);

      gallery.innerHTML = "";

      pagePhotos.forEach((photo, index) => {
        const div = document.createElement("div");
        div.className = "photo";

        const detailsId = `details-${index}`;

        div.innerHTML = `
            <img src="images/${photo.filename}" alt="${photo.title}">
            <h2>${photo.title}</h2>
            
            <!-- modellek -->
            ${Array.isArray(photo.models) && photo.models.length > 0 ? `
             <p><strong>Modellek:</strong> ${
                photo.models
                .map(id => {
                    const model = findModelById(id);

                    let namePart = model.name;
                    if (model.links && model.links.length > 0) {
                        const linksHtml = model.links.map(link => `<a href="${link}" target="_blank">üîó</a>`).join(" ");
                        namePart += ` ${linksHtml}`;
                    }
                    return namePart;
                })
            .filter(Boolean)
            .join(', ')
            }</p>
            ` : ""}            
            
            ${photo.note ? `<p><strong>Megjegyz√©s:</strong> ${photo.note}</p>` : ""}
        <button onclick="toggleDetails('${detailsId}')">üìÑ Eredm√©nyek megtekint√©se</button>
        <div id="${detailsId}" class="details" style="display: none;">
<ul>
  ${photo.results.map(r => {
    const salon = findSalonById(r.id);
    if (!salon) return "<li>‚ùì Ismeretlen verseny</li>";

    let awardPart = "";
    if (r.awarded) {
      awardPart = "üèÖ";
      if (r.certificateImage) {
        awardPart += `<br><a href="images/certs/${r.certificateImage}" target="_blank">${r.awardName || "D√≠jazott oklev√©l"}</a>`;
      } else if (r.awardName) {
        awardPart += ` ${r.awardName}`;
      }
    }

    return `
      <li>
        <strong>${salon.name}</strong> (${salon.country}, ${salon.year})
        ${r.accepted ? "‚úÖ" : "‚ùå"}
        ${awardPart}
      </li>
    `;
  }).join("")}
</ul>
        </div>`;
        gallery.appendChild(div);
    });


      renderPagination();
    }

    function renderPagination() {
      const totalPages = Math.ceil(filteredPhotos.length / PAGE_SIZE);
      const pagination = document.getElementById("pagination");
      pagination.innerHTML = "";

      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        if (i === currentPage) btn.disabled = true;
        btn.onclick = () => {
          currentPage = i;
          renderGallery();
        };
        pagination.appendChild(btn);
      }
    }

    document.getElementById("search").addEventListener("input", e => {
      searchTerm = e.target.value.trim().toLowerCase();
      currentPage = 1;
      applyFilters();
    });

    loadData();
    
    function toggleDetails(id) {
        const el = document.getElementById(id);
        if (el.style.display === "none") {
            el.style.display = "block";
        } else {
            el.style.display = "none";
        }
    }    
    
    function findSalonById(id) {
        return salons.find(salon => salon.ids.includes(id));
    }
    
    function findModelById(id) {
        return models.find(model => model.id === id);
    }    
    
const menuToggle = document.getElementById('menu-toggle');
const aside = document.querySelector('aside');
const contentWrapper = document.getElementById('content-wrapper');

menuToggle.addEventListener('click', () => {
  const isOpen = aside.classList.toggle('open');
  if (isOpen) {
    contentWrapper.classList.add('shifted');
    menuToggle.setAttribute('aria-label', 'Men√º bez√°r√°sa');
  } else {
    contentWrapper.classList.remove('shifted');
    menuToggle.setAttribute('aria-label', 'Men√º megnyit√°sa');
  }
});
    
  </script>
</body>
</html>
